<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Á´∂È¶¨„ÅÆÊú¨ÂëΩÈ¶¨„ÇíÂç†„ÅÜWeb„Ç¢„Éó„É™„ÄÇÊòüÂ∫ß„ÄÅË°ÄÊ∂≤Âûã„ÄÅ„É¨„Éº„ÇπÈÅ∏Êäû„ÅßÈÅãÂëΩ„ÅÆÈ¶¨„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ">
    <meta name="keywords" content="Á´∂È¶¨,Âç†„ÅÑ,Á´∂È¶¨‰∫àÊÉ≥,Êú¨ÂëΩÈ¶¨,ÂÆùÂ°öË®òÂøµ,ÂÆâÁî∞Ë®òÂøµ">
    <meta property="og:title" content="üèá Á´∂È¶¨Âç†„ÅÑ - „ÅÇ„Å™„Åü„ÅÆÊú¨ÂëΩÈ¶¨„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ">
    <meta property="og:description" content="ÊòüÂ∫ß„Å®Ë°ÄÊ∂≤Âûã„ÅßÈÅãÂëΩ„ÅÆÊú¨ÂëΩÈ¶¨„ÇíÂç†„ÅÑ„Åæ„Åô">
    <meta property="og:type" content="website">
    <title>üèá Á´∂È¶¨Âç†„ÅÑ - „ÅÇ„Å™„Åü„ÅÆÊú¨ÂëΩÈ¶¨„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ</title>
    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }

        .form-group select, .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .fortune-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 20px 0;
        }

        .fortune-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .fortune-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            display: none;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .horse-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .horse-number {
            font-size: 28px;
            font-weight: bold;
            color: #e17055;
            margin-bottom: 10px;
        }

        .horse-name {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }

        .fortune-message {
            color: #636e72;
            font-size: 14px;
            line-height: 1.6;
        }

        .reset-btn {
            background: #74b9ff;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .reset-btn:hover {
            background: #0984e3;
        }

        .loading {
            display: none;
            color: #667eea;
            font-size: 16px;
            margin: 20px 0;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .actual-horse-card {
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .actual-horse-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .actual-horse-name {
            font-size: 24px;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 8px;
        }

        .actual-horse-message {
            color: #636e72;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .fortune-btn {
                font-size: 16px;
                padding: 12px 30px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stripe Elements „ÅÆ„Çπ„Çø„Ç§„É´ */
        .stripe-element {
            background: white;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            margin: 10px 0;
            transition: border-color 0.3s;
        }

        .stripe-element.StripeElement--focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .stripe-element.StripeElement--invalid {
            border-color: #e74c3c;
        }

        .stripe-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }

        .payment-form {
            text-align: left;
            margin: 20px 0;
        }

        .payment-form label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        /* Ë°®Á¥ô„Éö„Éº„Ç∏„ÅÆ„Çπ„Çø„Ç§„É´ */
        .cover-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: -30px;
            border-radius: 20px;
            padding: 30px;
        }

        .cover-content {
            z-index: 2;
            position: relative;
        }

        .cover-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .cover-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .cover-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .cover-features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 40px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 18px;
            background: rgba(255,255,255,0.1);
            padding: 12px 25px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .feature-icon {
            font-size: 24px;
        }

        .start-btn {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 234, 167, 0.3);
            margin-bottom: 20px;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 234, 167, 0.4);
        }

        .cover-note {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 10px;
        }

        .floating-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .floating-element {
            position: absolute;
            font-size: 30px;
            animation: float 6s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        @media (max-width: 768px) {
            .cover-icon {
                font-size: 60px;
            }
            
            .cover-title {
                font-size: 36px;
            }
            
            .cover-subtitle {
                font-size: 18px;
            }
            
            .start-btn {
                font-size: 18px;
                padding: 15px 40px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Ë°®Á¥ô„Éö„Éº„Ç∏ -->
        <div id="coverPage" class="cover-page">
            <div class="cover-content">
                <div class="cover-icon">üèá</div>
                <h1 class="cover-title">Á´∂È¶¨Âç†„ÅÑ</h1>
                <p class="cover-subtitle">„ÅÇ„Å™„Åü„ÅÆÈÅãÂëΩ„ÅÆÊú¨ÂëΩÈ¶¨„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ</p>
                
                <div class="cover-features">
                    <div class="feature-item">
                        <span class="feature-icon">‚≠ê</span>
                        <span>ÊòüÂ∫ß„Å®Ë°ÄÊ∂≤Âûã„ÅßÂç†„ÅÜ</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üéØ</span>
                        <span>ÂÆüÈöõ„ÅÆ„É¨„Éº„ÇπÂá∫Ëµ∞È¶¨</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üíé</span>
                        <span>„Éó„É¨„Éü„Ç¢„É†‰∫àÊÉ≥¬•100</span>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startApp()">
                    üîÆ Âç†„ÅÑ„ÇíÂßã„ÇÅ„Çã
                </button>
                
                <p class="cover-note">
                    1‰Ωç‰∫àÊÉ≥„ÅØÁÑ°ÊñôÔºÅ2-5‰Ωç„ÅÆË©≥Á¥∞‰∫àÊÉ≥„ÅØ¬•100
                </p>
            </div>
            
            <div class="floating-elements">
                <div class="floating-element" style="top: 10%; left: 15%; animation-delay: 0s;">üêé</div>
                <div class="floating-element" style="top: 20%; right: 20%; animation-delay: 1s;">‚≠ê</div>
                <div class="floating-element" style="bottom: 30%; left: 10%; animation-delay: 2s;">üèÜ</div>
                <div class="floating-element" style="bottom: 20%; right: 15%; animation-delay: 3s;">üéØ</div>
            </div>
        </div>

        <!-- „É°„Ç§„É≥„Ç¢„Éó„É™ -->
        <div id="mainApp" style="display: none;">
            <div class="header">
                <h1>üèá Á´∂È¶¨Âç†„ÅÑ</h1>
                <p>„ÅÇ„Å™„Åü„ÅÆÈÅãÂëΩ„ÅÆÊú¨ÂëΩÈ¶¨„ÇíË¶ã„Å§„Åë„Åæ„Åó„Çá„ÅÜÔºÅ</p>
            </div>

        <form id="fortuneForm" action="javascript:void(0);">
            <div class="form-group">
                <label for="zodiac">ÊòüÂ∫ß„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</label>
                <select id="zodiac" required>
                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                    <option value="aries">Áâ°ÁæäÂ∫ß (3/21-4/19)</option>
                    <option value="taurus">Áâ°ÁâõÂ∫ß (4/20-5/20)</option>
                    <option value="gemini">ÂèåÂ≠êÂ∫ß (5/21-6/21)</option>
                    <option value="cancer">ËüπÂ∫ß (6/22-7/22)</option>
                    <option value="leo">ÁçÖÂ≠êÂ∫ß (7/23-8/22)</option>
                    <option value="virgo">‰πôÂ•≥Â∫ß (8/23-9/22)</option>
                    <option value="libra">Â§©Áß§Â∫ß (9/23-10/23)</option>
                    <option value="scorpio">Ë†çÂ∫ß (10/24-11/22)</option>
                    <option value="sagittarius">Â∞ÑÊâãÂ∫ß (11/23-12/21)</option>
                    <option value="capricorn">Â±±ÁæäÂ∫ß (12/22-1/19)</option>
                    <option value="aquarius">Ê∞¥Áì∂Â∫ß (1/20-2/18)</option>
                    <option value="pisces">È≠öÂ∫ß (2/19-3/20)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="bloodType">Ë°ÄÊ∂≤Âûã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</label>
                <select id="bloodType" required>
                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                    <option value="A">AÂûã</option>
                    <option value="B">BÂûã</option>
                    <option value="O">OÂûã</option>
                    <option value="AB">ABÂûã</option>
                </select>
            </div>

            <div class="form-group">
                <label for="targetRace">„ÅÇ„Å™„Åü„ÅÆ‰ªäÂõû√óÁ´∂È¶¨„ÅØ‰Ωï„Åß„Åô„ÅãÔºü</label>
                <select id="targetRace" required>
                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                    <option value="takarazuka">ÂÆùÂ°öË®òÂøµ (6/15 Èò™Á•û)</option>
                    <option value="yasuda">ÂÆâÁî∞Ë®òÂøµ (6/8 Êù±‰∫¨) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="derby">Êó•Êú¨„ÉÄ„Éº„Éì„Éº (6/1 Êù±‰∫¨) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="oaks">„Ç™„Éº„ÇØ„Çπ (5/25 Êù±‰∫¨) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="victoria">„É¥„Ç£„ÇØ„Éà„É™„Ç¢„Éû„Ç§„É´ (5/11 Êù±‰∫¨) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="tennosho_spring">Â§©ÁöáË≥û(Êò•) (4/27 ‰∫¨ÈÉΩ) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="oka_sho">Ê°úËä±Ë≥û (4/6 Èò™Á•û) ‚ÄªÁµÇ‰∫Ü</option>
                    <option value="satsuki_sho">ÁöêÊúàË≥û (4/13 ‰∏≠Â±±) ‚ÄªÁµÇ‰∫Ü</option>
                </select>
            </div>

            <div class="form-group">
                <label for="luckyNumber">‰ªäÊó•„ÅÆ„É©„ÉÉ„Ç≠„Éº„Éä„É≥„Éê„Éº (1-18)</label>
                <input type="number" id="luckyNumber" min="1" max="18" required placeholder="1„Åã„Çâ18„ÅÆÊï∞Â≠ó„ÇíÂÖ•Âäõ">
            </div>

            <button type="button" class="fortune-btn" onclick="startFortune()">üîÆ Êú¨ÂëΩÈ¶¨„ÇíÂç†„ÅÜ</button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            ÈÅãÂëΩ„ÅÆÈ¶¨„ÇíÊé¢Á¥¢‰∏≠...
        </div>

        <div class="result-container" id="result">
            <div class="result-title">üéØ „ÅÇ„Å™„Åü„ÅÆÊú¨ÂëΩ„ÅØ„Åì„Å°„ÇâÔºÅ</div>
            <div class="horse-card" id="horseCard">
                <div class="horse-number" id="horseNumber"></div>
                <div class="horse-name" id="horseName"></div>
                <div class="fortune-message" id="fortuneMessage"></div>
            </div>
            <div id="actualHorseContainer"></div>
            <button class="reset-btn" onclick="resetForm()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶Âç†„ÅÜ</button>
        </div>
    </div>

    <script>
        // StripeÂÖ¨ÈñãÈçµÔºàÊñ∞„Åó„ÅÑ„Ç¢„Ç´„Ç¶„É≥„ÉàÔºâ
        const STRIPE_PUBLIC_KEY = 'pk_test_51RhtyeCk5JGiuAKupKRqpZr7IajPez21srAHY8JGxqpJanb3nvoBJTVvDsocOqCGTHayR8sI3kbM2ysOqam72wVd008s7jnbKU';
        
        let stripe;
        let elements;
        let cardElement;

        // ÂÆüÈöõ„ÅÆ„É¨„Éº„ÇπÂá∫Ëµ∞È¶¨„Éá„Éº„Çø„Éô„Éº„Çπ
        const raceHorses = {
            'takarazuka': [
                '„Éô„É©„Ç∏„Ç™„Ç™„Éö„É©', '„É≠„Éº„Éâ„Éá„É´„É¨„Ç§', '„É¨„Ç¨„É¨„Ç§„É©', '„Ç¢„Éº„Éê„É≥„Ç∑„ÉÉ„ÇØ', 
                '„Éâ„Ç•„É¨„ÉÉ„ÉÑ„Ç°', '„É®„Éº„Éõ„Éº„É¨„Ç§„ÇØ', '„Ç∏„É£„Çπ„ÉÜ„Ç£„É≥„Éë„É¨„Çπ', '„Ç∑„Éß„Ç¶„Éä„É≥„É©„Éó„É≥„Çø',
                '„É°„Ç§„Ç∑„Éß„Ç¶„Çø„Éê„É´', '„ÇΩ„Éº„É´„Ç™„É™„Ç®„É≥„Çπ', '„É≠„Éº„Ç∑„É£„É†„Éë„Éº„ÇØ', '„ÉÄ„Éé„É≥„Éô„É´„Éº„Ç¨',
                '„É™„Éì„Ç¢„É≥„Ç∞„É©„Çπ', '„Éú„É´„Éâ„Ç∞„Éï„Éº„Ç∑„É•', '„ÉÅ„É£„ÉÉ„ÇØ„Éç„Ç§„Éà', '„Ç∏„É•„Éº„É≥„ÉÜ„Ç§„ÇØ',
                '„Ç∑„É•„É¥„Ç°„É™„Ç®„É≠„Éº„Ç∫', '„Éó„É©„ÉÄ„É™„Ç¢'
            ],
            'yasuda': [
                '„Ç∏„É£„É≥„Çø„É´„Éû„É≥„Çø„É´', '„Ç¨„Ç§„Ç¢„Éï„Ç©„Éº„Çπ', '„ÇΩ„Ç¶„É´„É©„ÉÉ„Ç∑„É•', '„Éñ„É¨„Ç§„Éá„Ç£„É¥„Çß„Éº„Ç∞',
                '„Ç∑„ÉÉ„ÇØ„Çπ„Éö„É≥„Çπ', '„Ç∏„É•„É≥„Éñ„É≠„ÉÉ„Çµ„É†', '„Éû„ÉÉ„Éâ„ÇØ„Éº„É´', '„Ç¶„Ç§„É≥„Éû„Éº„Éô„É´',
                '„Éà„É≠„É¥„Ç°„Éà„Éº„É¨', '„Ç∑„É£„É≥„Éë„É≥„Ç´„É©„Éº', '„Ç®„Ç≥„É≠„É¥„Ç°„É´„ÉÑ', '„Éó„É™„ÉÜ„Ç£„Ç¢„É≥„Ç∏„Çß„É´',
                '„É¥„Çß„É≠„Éº„Éä„Ç∑„ÉÅ„Éº', '„Çπ„É¨„Éº„Éà„Éá„Ç∏„Çø„É´', '„Éê„Ç§„Ç™„Çπ„Éï„Ç£„Ç¢', '„Éä„É†„É©„ÇØ„É¨„Ç¢',
                '„É¢„Éº„Éâ„Éñ„É™„Éº„Ç∫', '„É¨„Ç∏„Éº„Éä„É°„ÉÉ„Çª'
            ],
            'derby': [
                '„ÇØ„É≠„ÉØ„Éá„É•„Éé„Éº„É´', '„Ç¢„É™„Çπ„Éà„ÉÜ„É¨„Çπ', '„Ç∑„Éß„Ç¶„Éä„É≥„Éû„ÉÉ„Ç≠„Éº', '„É¨„Çæ„Éä„É≥„Çπ',
                '„ÉØ„Éº„É´„Éâ„É™„Éê„Éº', '„Ç∑„É≥„Ç®„É≥„Éö„É©„Éº', '„Éõ„Ç¶„Ç™„Ç¶„Ç¨„Ç§„Ç¢', '„Ç¢„Éâ„Éû„Ç§„É§„Éô„É´„ÇØ',
                '„Çπ„ÉÜ„É©„É™„Ç¢', '„Çµ„Éº„Éû„É´„Ç®„Éä„Ç∏„Éº', '„Éñ„É´„Éº„Éü„É≥„Ç∞„Çπ„Ç´„Ç§', '„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢',
                '„ÉÄ„É≥„ÉÑ„Éï„Ç©„ÉØ„Éº„Éâ', '„Çµ„É©„Éñ„É¨„Éâ„Éë„Ç§', '„Éö„Ç¨„Çµ„Çπ„ÉÜ„Éº„É´', '„Ç∑„É´„Éê„Éº„Ç¶„Ç£„É≥„Ç∞„Çπ',
                '„Ç≥„Çπ„É¢„ÉÜ„Ç£„Ç¢„É©', '„É¨„Éá„Ç£„Éº„É≠„Éº„Ç∫'
            ],
            'oaks': [
                '„É©„Ç§„Éà„Éê„ÉÉ„ÇØ', '„ÇØ„É¨„É†„Çπ„Éá„Ç£„Ç™', '„É¨„Ç¨„É¨„Ç§„É©', '„Éé„Éº„Éô„É´„Çπ„Éû„Ç§„É´',
                '„Ç™„Éº„ÇØ„Ç∑„Éß„É≥„Éè„Ç¶„Çπ', '„ÉÄ„Çπ„Éà„Éá„Éì„É´', '„Éû„É™„ÇΩ„Éº„Éó', '„Ç¢„Ç∫„Çµ„É≥',
                '„Ç∑„Éº„Éã„ÉÉ„ÇØ„Ç¨„Éº„Éá„É≥', '„ÇØ„É©„Ç§„Éû„ÉÉ„ÇØ„Çπ„Éá„Éº', '„Ç¢„Éº„Éà„Ç≤„É´', '„Ç≥„Çπ„É¢„Éñ„É´„Éº',
                '„Éû„Ç§„Éò„ÉÉ„Éâ', '„ÉÄ„Éº„ÇØ„Éï„Ç°„É≥„Çø„Ç∏„Éº', '„Ç¥„Éº„É´„Éá„É≥„Ç¶„Ç£„É≥„Ç∞', '„Çπ„Çø„Éº„É©„Ç§„Éà',
                '„Ç¢„Éô„Éã„É•„Éº„Ç¢„Éº„Éà', '„É©„Éñ„É™„Éº„Éó„É™„É≥„Çª„Çπ'
            ],
            'victoria': [
                '„É¨„Ç¨„É¨„Ç§„É©', '„Éñ„É¨„Ç§„Éá„Ç£„É¥„Çß„Éº„Ç∞', '„Ç∑„ÉÉ„ÇØ„Çπ„Éö„É≥„Çπ', '„Ç¢„Ç´„Ç§„Éà„É™„Éé„É†„Çπ„É°',
                '„É™„Éê„ÉÜ„Ç£„Ç¢„Ç§„É©„É≥„Éâ', '„Çµ„É≥„ÇØ„ÉÜ„É•„Ç®„Éº„É´', '„ÇΩ„Éº„É¥„Ç°„É™„Ç¢„É≥„Éà', '„É¢„Éº„É™„Çπ',
                '„Éä„Çπ„Éé„É¶„É°', '„É™„É•„Éº„Éã„É≥„Ç∞', '„Çπ„Éà„Éº„Éü„Éº„Ç∑„Éº', '„Ç¢„É´„Ç¢„Ç§„É≥',
                '„Çπ„Ç´„Éº„É¨„ÉÉ„Éà„Ç´„É©„Éº', '„É°„Ç§„Ç±„Ç§„Ç®„Éº„É´', '„Éó„É™„ÉÜ„Ç£„Ç¢„É≥„Ç∏„Çß„É´', '„É™„Ç™„É≥„É™„Ç™„É≥',
                '„É¥„Çß„É≠„Éã„Ç´', '„Ç∑„É´„Éì„Ç¢„É≥'
            ],
            'tennosho_spring': [
                '„É¨„Ç¨„É¨„Ç§„É©', '„Ç∑„Éß„Ç¶„Éä„É≥„É©„Éó„É≥„Çø', '„É¥„Çß„É≠„Éº„Éä„Ç∑„ÉÅ„Éº', '„Çø„Ç§„Éà„É´„Éõ„É´„ÉÄ„Éº',
                '„Çπ„É¨„Éº„Éà„Éá„Ç∏„Çø„É´', '„Ç¶„Ç©„Éº„Çø„Éº„É™„Éí„Éà', '„Ç¢„É¥„Ç°„É≥„Çª', '„Ç≠„É≥„Ç∞„Çπ„Ç™„Éº„ÉÄ„Éº',
                '„ÉÜ„É≥„Éù„Ç§„É≥„Éà', '„Ç¥„Éº„É´„Éâ„Ç¢„ÇØ„Çø„Éº', '„Ç¶„Ç∑„É•„Éê„ÉÜ„ÇΩ„Éº„É≠', '„Éâ„Ç•„É¨„ÉÉ„ÉÑ„Ç¢',
                '„ÉØ„Éº„É´„Éâ„Éó„É¨„Éü„Ç¢', '„Éñ„É©„Çπ„Éà„ÉØ„É≥„Éî„Éº„Çπ', '„ÇΩ„Éº„É´„Ç™„É™„Ç®„É≥„Çπ', '„Ç®„Éº„Éá„É´„ÉØ„Ç§„Çº',
                '„Ç∑„É•„É´„É¥„Ç£„É≥', '„Çπ„Éö„ÇØ„Çø„ÇØ„É´'
            ],
            'oka_sho': [
                '„É©„Ç§„Éà„Éê„ÉÉ„ÇØ', '„É¨„Ç¨„É¨„Ç§„É©', '„ÇØ„É¨„É†„Çπ„Éá„Ç£„Ç™', '„É©„Ç§„Éï„Éê„É≥„ÇØ„Éº',
                '„Éà„Ç•„Éâ„Ç¢„Éó„É©„Ç§„É†', '„ÇΩ„Éï„Ç£„Ç¢„É©„Ç§„Éñ', '„Éã„É•„Éº„É¢„Éá„É´', '„Ç¥„Éº„É´„Éâ„Éè„É≥„Çø„Éº',
                '„Éã„Ç∑„Éé„Ç≥„É≥„Ç≠„Çπ„Çø', '„Éé„Éº„Éô„É´„Çπ„Éû„Ç§„É´', '„Ç®„É†„ÉÜ„Ç£„Éº„Éì„Éº', '„É™„É™„Ç´„É´„Éõ„ÉØ„Ç§„Éà',
                '„Çµ„ÇØ„É©„Éó„É≠„Éü„Çπ', '„Éì„Ç¢„É≥„Ç´', '„Éî„É≥„ÇØ„Ç´„É°„Éè„É°„Éè', '„ÇΩ„É™„Çø„É™„Éº',
                '„Ç∞„É©„É≥„Éâ„Çπ„É©„É†', '„É¨„Éá„Ç£„Éº„Éï„É¨„Ç§'
            ],
            'satsuki_sho': [
                '„Ç¢„É™„Çπ„Éà„ÉÜ„É¨„Çπ', '„Ç∑„Éß„Ç¶„Éä„É≥„Éû„ÉÉ„Ç≠„Éº', '„É¨„Çæ„Éä„É≥„Çπ', '„Ç∑„É≥„Ç®„É≥„Éö„É©„Éº',
                '„Ç¢„Éâ„Éû„Ç§„É§„Éô„É´„ÇØ', '„Éñ„É´„Éº„Éü„É≥„Ç∞„Çπ„Ç´„Ç§', '„ÉÄ„É≥„ÉÑ„Éï„Ç©„ÉØ„Éº„Éâ', '„Ç¢„Çπ„ÇØ„Éâ„É™„Éº„É†„Çπ',
                '„Ç≥„Ç∫„Éü„ÉÉ„ÇØ„Éï„Ç©„Éº„Çπ', '„Éõ„Ç¶„Ç™„Ç¶„Ç¨„Ç§„Ç¢', '„Éï„É≠„É≥„ÉÜ„Ç£„Ç¢', '„Çµ„Éº„Éû„É´„Ç®„Éä„Ç∏„Éº',
                '„Éö„Ç¨„Çµ„Çπ„ÉÜ„Éº„É´', '„Éà„Éº„Çª„É≥„Ç¢„É©„É≥', '„Çπ„Éº„Éë„Éº„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ', '„Ç®„Ç¢„Éï„Ç©„Éº„Çπ',
                '„Ç∑„É´„Éê„Éº„Ç¶„Ç£„É≥„Ç∞„Çπ', '„É≠„Éº„Éâ„Çπ„Éà„Éº„É†'
            ]
        };

        // Âç†„ÅÑ„É°„ÉÉ„Çª„Éº„Ç∏ÔºàÂØæË±°„É¨„Éº„ÇπÂà•Ôºâ
        const raceSpecificMessages = {
            'takarazuka': [
                "ÂÆùÂ°öË®òÂøµ„ÅØ‰∏äÂçäÊúü„ÅÆÈ†ÇÁÇπ„ÇíÊ±∫„ÇÅ„Çã‰∏ÄÊà¶ÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Ê†ÑÂÖâ„Çí„ÇÇ„Åü„Çâ„Åó„Åæ„Åô„ÄÇ",
                "Èò™Á•ûÁ´∂È¶¨Â†¥„ÅÆÂùÇ„ÇíÂà∂„Åô„Çã„ÅÆ„ÅØ„Åì„ÅÆÈ¶¨„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂøúÊè¥„ÅåÂãùÂà©„Å∏„ÅÆÈçµ„Å®„Å™„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
                "„Éï„Ç°„É≥ÊäïÁ•®„ÅÆÂÆùÂ°öË®òÂøµ„ÄÅ„ÅÇ„Å™„Åü„ÅÆÂøÉ„ÅåÈÅ∏„Çì„Å†„Åì„ÅÆÈ¶¨„ÅåÂ•áË∑°„ÇíËµ∑„Åì„Åó„Åæ„Åô„ÄÇ"
            ],
            'yasuda': [
                "ÂÆâÁî∞Ë®òÂøµ„ÅØ„Éû„Ç§„É´ÁéãÊ±∫ÂÆöÊà¶ÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÈÄü„Åï„Å®ËààÂ•Æ„ÇíÂ±ä„Åë„Å¶„Åè„Çå„Åæ„Åó„Åü„ÄÇ",
                "Êù±‰∫¨1600m„ÇíÂà∂„Åó„Åü„Åì„ÅÆÈ¶¨„ÄÅ„ÅÇ„Å™„Åü„ÅÆÁõ¥ÊÑüÂäõ„ÅÆË®ºÊòé„Åß„Åô„ÄÇ",
                "„Çπ„Éî„Éº„Éâ„ÅÆÁ•≠ÂÖ∏„ÅßÈÅ∏„Å∞„Çå„Åó„Åì„ÅÆÈ¶¨„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁµêÊûú„Å†„Å£„Åü„ÅØ„Åö„Åß„Åô„ÄÇ"
            ],
            'derby': [
                "Êó•Êú¨„ÉÄ„Éº„Éì„Éº„ÅØ3Ê≠≥È¶¨„ÅÆÊúÄÈ´òÂ≥∞ÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´„ÇØ„É©„Ç∑„ÉÉ„ÇØ„ÅÆÊÑüÂãï„Çí„ÇÇ„Åü„Çâ„Åó„Åæ„Åó„Åü„ÄÇ",
                "Â∫ú‰∏≠„ÅÆÁõ¥Á∑ö„ÇíÈßÜ„ÅëÊäú„Åë„Åü„Åì„ÅÆÈ¶¨„ÄÅ„ÅÇ„Å™„Åü„ÅÆÈùíÊò•„ÅÆ1„Éö„Éº„Ç∏„ÇíÈ£æ„Å£„Åü„ÅØ„Åö„Åß„Åô„ÄÇ",
                "„ÉÄ„Éº„Éì„ÉºÈ¶¨„ÅØ„Éí„Éº„É≠„ÉºÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Ê∞∏ÈÅ†„ÅÆÊÄù„ÅÑÂá∫„ÇíÊÆã„Åó„Å¶„Åè„Çå„Åæ„Åó„Åü„ÄÇ"
            ],
            'oaks': [
                "„Ç™„Éº„ÇØ„Çπ„ÅØÁâùÈ¶¨„ÇØ„É©„Ç∑„ÉÉ„ÇØ„ÅÆÈ†ÇÁÇπÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Â•≥Áéã„ÅÆËºù„Åç„Çí„ÇÇ„Åü„Çâ„Åó„Åæ„Åô„ÄÇ",
                "Áæé„Åó„ÅçÁâùÈ¶¨„ÅÆÊà¶„ÅÑ„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆÂøÉ„ÇíÈ≠Ö‰∫Ü„Åô„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
                "Ê°úËä±Ë≥û„Å´Á∂ö„ÅèÊ†ÑÂÖâ„Å∏„ÅÆÈÅì„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å®ÂÖ±„Å´Ê≠©„Åø„Åæ„Åô„ÄÇ"
            ],
            'victoria': [
                "„É¥„Ç£„ÇØ„Éà„É™„Ç¢„Éû„Ç§„É´„ÅØÊò•„ÅÆÂ•≥ÁéãÊ±∫ÂÆöÊà¶ÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÂãùÂà©„ÅÆÂ•≥Á•û„ÇíÂ±ä„Åë„Åæ„Åô„ÄÇ",
                "ÁâùÈ¶¨„Éû„Ç§„É´ÁéãËÄÖ„ÅÆË®º„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆ„Éó„É©„Ç§„Éâ„Å®„Å™„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ",
                "Êù±‰∫¨Ëäù1600m„ÇíÂà∂„Åô„ÇãÂ•≥ÂÇë„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÂäõÂº∑„Åï„Çí‰∏é„Åà„Å¶„Åè„Çå„Åæ„Åô„ÄÇ"
            ],
            'tennosho_spring': [
                "Â§©ÁöáË≥ûÊò•„ÅØÈï∑Ë∑ùÈõ¢Áéã„ÅÆË®ºÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÊåÅ‰πÖÂäõ„Å®Á≤ò„ÇäÂº∑„Åï„ÇíÊéà„Åë„Åæ„Åô„ÄÇ",
                "‰∫¨ÈÉΩ3200m„ÅÆÊøÄÈóò„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆÂøçËÄêÂäõ„ÇíÁâ©Ë™û„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                "Êò•„ÅÆÁõæ„ÇíÊâã„Å´„Åô„ÇãËÄÖ„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÊúÄÈ´ò„ÅÆÊ†ÑË™â„Çí„ÇÇ„Åü„Çâ„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ"
            ],
            'oka_sho': [
                "Ê°úËä±Ë≥û„ÅØÁâùÈ¶¨„ÇØ„É©„Ç∑„ÉÉ„ÇØÁ¨¨‰∏ÄÂºæÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Êò•„ÅÆÊÅØÂêπ„ÇíÂ±ä„Åë„Åæ„Åô„ÄÇ",
                "3Ê≠≥ÁâùÈ¶¨„ÅÆÈ†ÇÁÇπ„ÇíÊ±∫„ÇÅ„ÇãÊà¶„ÅÑ„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆÊñ∞„Åü„Å™Âá∫Áô∫„ÇíÁ•ùÁ¶è„Åó„Åæ„Åô„ÄÇ",
                "Ê°úÂí≤„ÅèÈò™Á•û„ÅßËºù„ÅèÂ•≥Áéã„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Áæé„Åó„ÅÑÊú™Êù•„ÇíÁ¥ÑÊùü„Åó„Å¶„Åè„Çå„Åæ„Åô„ÄÇ"
            ],
            'satsuki_sho': [
                "ÁöêÊúàË≥û„ÅØ„ÇØ„É©„Ç∑„ÉÉ„ÇØÈñãÂπïÊà¶ÔºÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Êñ∞Á∑ë„ÅÆÂäõ„Çí‰∏é„Åà„Å¶„Åè„Çå„Åæ„Åô„ÄÇ",
                "3Ê≠≥Áâ°È¶¨„ÅÆÁ¨¨‰∏ÄÈñ¢ÈñÄ„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏Á≤æÁ•û„ÇíË°®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                "‰∏≠Â±±Ëäù2000m„ÇíÂà∂„Åô„ÇãËã•Ê≠¶ËÄÖ„ÄÅ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´ÂãáÊ∞ó„Çí„ÇÇ„Åü„Çâ„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ"
            ]
        };

        const defaultMessages = [
            "‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„Å´„ÅØÂãùÂà©„ÅÆÈ¢®„ÅåÂêπ„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´Âπ∏ÈÅã„Çí„ÇÇ„Åü„Çâ„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ",
            "Êòü„ÅÆÈÖçÁΩÆ„Åå„ÅÇ„Å™„Åü„Å®„Åì„ÅÆÈ¶¨„ÅÆÁµÜ„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰ø°„Åò„Å¶ÂøúÊè¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",
            "„ÅÇ„Å™„Åü„ÅÆÁõ¥ÊÑüÂäõ„ÅåÊúÄÈ´òÊΩÆ„Å´ÈÅî„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆÈ¶¨„ÅåÂ•áË∑°„ÇíËµ∑„Åì„Åô„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ",
            "ÈÅãÂëΩ„ÅÆÊ≠ØËªä„ÅåÂãï„ÅçÂßã„ÇÅ„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„ÅÆÊúüÂæÖ„Å´Âøú„Åà„Å¶„Åè„Çå„Çã„ÅØ„Åö„Åß„Åô„ÄÇ",
            "‰ªäÊó•„ÅÆ„ÅÇ„Å™„Åü„ÅÆ„Ç™„Éº„É©„ÅØÁâπÂà•„Åß„Åô„ÄÇ„Åì„ÅÆÈ¶¨„Å®ÂÖ±„Å´Ê†ÑÂÖâ„ÇíÊé¥„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ",
            "ÂÆáÂÆô„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº„Åå„Åì„ÅÆÈ¶¨„Å´ÈõÜ‰∏≠„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂ§ß„Åç„Å™ÂèØËÉΩÊÄß„ÇíÁßò„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
            "„ÅÇ„Å™„Åü„ÅÆÂøÉ„ÅÆÂ£∞„Åå„Åì„ÅÆÈ¶¨„ÇíÈÅ∏„Å≥„Åæ„Åó„Åü„ÄÇ„Åç„Å£„Å®Á¥†Êô¥„Çâ„Åó„ÅÑÁµêÊûú„ÅåÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
            "‰ªäÊó•„ÅØÁâπÂà•„Å™Êó•„Åß„Åô„ÄÇ„Åì„ÅÆÈ¶¨„Åå„ÅÇ„Å™„Åü„Å´‰∫àÊÉ≥„ÇíË∂Ö„Åà„ÇãÂñú„Å≥„Çí„ÇÇ„Åü„Çâ„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ"
        ];

        // StripeÂàùÊúüÂåñ
        function initializeStripe() {
            if (typeof Stripe !== 'undefined') {
                stripe = Stripe(STRIPE_PUBLIC_KEY);
                elements = stripe.elements();
                
                // „Ç´„Éº„ÉâË¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´
                const cardStyle = {
                    style: {
                        base: {
                            fontSize: '16px',
                            color: '#424770',
                            '::placeholder': {
                                color: '#aab7c4',
                            },
                        },
                        invalid: {
                            color: '#9e2146',
                        },
                    },
                };
                
                cardElement = elements.create('card', cardStyle);
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´StripeÂàùÊúüÂåñ
        window.addEventListener('load', initializeStripe);

        // Ë°®Á¥ô„Åã„Çâ„É°„Ç§„É≥„Ç¢„Éó„É™„Å∏„ÅÆÁßªË°å
        function startApp() {
            document.getElementById('coverPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        function startFortune() {
            const zodiac = document.getElementById('zodiac').value;
            const bloodType = document.getElementById('bloodType').value;
            const targetRace = document.getElementById('targetRace').value;
            const luckyNumber = parseInt(document.getElementById('luckyNumber').value);

            if (!zodiac || !bloodType || !targetRace || !luckyNumber) {
                alert('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.querySelector('.fortune-btn').disabled = true;

            // Âç†„ÅÑË®àÁÆóÔºà2ÁßíÂæå„Å´ÁµêÊûúË°®Á§∫Ôºâ
            setTimeout(() => {
                const result = calculateFortune(zodiac, bloodType, targetRace, luckyNumber);
                displayResult(result);
            }, 2000);
        }

        function calculateFortune(zodiac, bloodType, targetRace, luckyNumber) {
            // Âç†„ÅÑ„É≠„Ç∏„ÉÉ„ÇØ
            let seed = 0;
            
            // ÊòüÂ∫ß„Å´„Çà„ÇãÂü∫Êú¨Êï∞ÂÄ§
            const zodiacValues = {
                'aries': 1, 'taurus': 2, 'gemini': 3, 'cancer': 4,
                'leo': 5, 'virgo': 6, 'libra': 7, 'scorpio': 8,
                'sagittarius': 9, 'capricorn': 10, 'aquarius': 11, 'pisces': 12
            };
            
            // Ë°ÄÊ∂≤Âûã„Å´„Çà„Çã‰øÇÊï∞
            const bloodTypeValues = {
                'A': 3, 'B': 7, 'O': 11, 'AB': 13
            };

            // ÂØæË±°„É¨„Éº„Çπ„Å´„Çà„ÇãË£úÊ≠£ÂÄ§
            const raceValues = {
                'takarazuka': 5, 'yasuda': 8, 'derby': 12, 'oaks': 9,
                'victoria': 6, 'tennosho_spring': 15, 'oka_sho': 4, 'satsuki_sho': 7
            };

            seed = (zodiacValues[zodiac] * bloodTypeValues[bloodType] + raceValues[targetRace] + luckyNumber) % 18 + 1;
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„É¨„Éº„Çπ„ÅÆÂá∫Ëµ∞È¶¨„Åã„ÇâÊú¨ÂëΩ„ÇíÈÅ∏Êäû
            const raceHorsesList = raceHorses[targetRace] || [];
            const horseIndex = (seed - 1) % raceHorsesList.length;
            const horseName = raceHorsesList[horseIndex];
            
            // ‰ªñ„ÅÆÈ†Ü‰Ωç„ÅÆÈ¶¨„Çí„É©„É≥„ÉÄ„É†„ÅßÈÅ∏ÊäûÔºàÊú¨ÂëΩ‰ª•Â§ñ„Åã„ÇâÔºâ
            const otherHorses = raceHorsesList.filter((_, index) => index !== horseIndex);
            const shuffledHorses = [...otherHorses].sort(() => Math.random() - 0.5);
            
            const rankings = {
                first: horseName,
                second: shuffledHorses[0] || 'Êú™ÂÆö',
                third: shuffledHorses[1] || 'Êú™ÂÆö',
                fourth: shuffledHorses[2] || 'Êú™ÂÆö',
                fifth: shuffledHorses[3] || 'Êú™ÂÆö'
            };
            
            // ÂØæË±°„É¨„Éº„ÇπÂà•„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèñÂæó
            const messages = raceSpecificMessages[targetRace] || defaultMessages;
            const message = messages[Math.floor(Math.random() * messages.length)];

            return {
                number: seed,
                name: horseName,
                message: message,
                race: targetRace,
                rankings: rankings
            };
        }

        function displayResult(result) {
            document.getElementById('loading').style.display = 'none';
            
            document.getElementById('horseNumber').textContent = `1‰ΩçÔºàÊú¨ÂëΩÔºâ`;
            document.getElementById('horseName').textContent = result.name;
            document.getElementById('fortuneMessage').textContent = result.message;
            
            // È†Ü‰Ωç‰∫àÊÉ≥„ÇíË°®Á§∫„Åô„ÇãÈÉ®ÂàÜÔºà1‰Ωç„ÅÆ„ÅøË°®Á§∫„ÄÅ2-5‰Ωç„ÅØÈö†„ÅôÔºâ
            const actualHorseContainer = document.getElementById('actualHorseContainer');
            actualHorseContainer.innerHTML = ''; // „ÇØ„É™„Ç¢
            
            if (result.rankings) {
                const rankingCard = document.createElement('div');
                rankingCard.className = 'actual-horse-card';
                
                rankingCard.innerHTML = `
                    <div class="actual-horse-title">
                        üèÜ „ÅÇ„Å™„Åü„ÅÆ‰∫àÊÉ≥È†Ü‰Ωç
                    </div>
                    <div style="text-align: left; line-height: 1.8; font-size: 16px; color: #2d3436;">
                        <div style="margin: 8px 0;"><strong>ü•á 1‰ΩçÔºàÊú¨ÂëΩÔºâ:</strong> <span style="color: #e17055; font-weight: bold;">${result.rankings.first}</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ü•à 2‰Ωç:</strong> <span style="color: #666;">‚óã‚óã‚óã‚óã‚óã‚óã</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ü•â 3‰Ωç:</strong> <span style="color: #666;">‚óã‚óã‚óã‚óã‚óã‚óã</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>üìç 4‰Ωç:</strong> <span style="color: #666;">‚óã‚óã‚óã‚óã‚óã‚óã</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>üìç 5‰Ωç:</strong> <span style="color: #666;">‚óã‚óã‚óã‚óã‚óã‚óã</span></div>
                    </div>
                    <div class="actual-horse-message" style="margin-top: 15px;">
                        1‰Ωç„ÅÆÊú¨ÂëΩÈ¶¨„ÅØ„ÅÇ„Å™„Åü„ÅÆÈÅãÂëΩ„ÅåÈÅ∏„Çì„Å†ÁâπÂà•„Å™È¶¨„Åß„Åô
                    </div>
                `;
                
                actualHorseContainer.appendChild(rankingCard);
                
                // ÊúâÊñô„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Éú„Çø„É≥„ÇíËøΩÂä†
                const premiumCard = document.createElement('div');
                premiumCard.style.marginTop = '20px';
                premiumCard.innerHTML = `
                    <button onclick="showPremiumModal()" style="
                        background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 25px;
                        font-size: 16px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: transform 0.3s;
                        box-shadow: 0 5px 15px rgba(232, 67, 147, 0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                        ‚ú® 2‰Ωç‰ª•‰∏ã„ÇÇÁü•„Çä„Åü„ÅÑÔºÅ
                    </button>
                `;
                
                actualHorseContainer.appendChild(premiumCard);
            }
            
            // ÁµêÊûú„Éá„Éº„Çø„Çí‰øùÂ≠òÔºàÊ±∫Ê∏àÂæå„Å´‰ΩøÁî®Ôºâ
            window.currentResult = result;
            
            document.getElementById('result').style.display = 'block';
            document.querySelector('.fortune-btn').disabled = false;
            
            // ÁµêÊûú„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('fortuneForm').reset();
            document.getElementById('result').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.querySelector('.fortune-btn').disabled = false;
            document.getElementById('actualHorseContainer').innerHTML = '';
            
            // „Éó„É¨„Éü„Ç¢„É†„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // „Éó„É¨„Éü„Ç¢„É†Ê©üËÉΩ„ÅÆ„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showPremiumModal() {
            // „É¢„Éº„ÉÄ„É´„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ‰ΩúÊàê
            let modal = document.getElementById('premiumModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'premiumModal';
                modal.style.cssText = `
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.8);
                    animation: fadeIn 0.3s ease-out;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white;
                        margin: 5% auto;
                        padding: 30px;
                        border-radius: 20px;
                        width: 90%;
                        max-width: 500px;
                        text-align: center;
                        position: relative;
                        animation: slideIn 0.3s ease-out;
                        max-height: 90vh;
                        overflow-y: auto;
                    ">
                        <button onclick="closePremiumModal()" style="
                            position: absolute;
                            right: 15px;
                            top: 15px;
                            background: none;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                            color: #999;
                        ">√ó</button>
                        
                        <h2 style="color: #e84393; margin-bottom: 20px;">üåü „Éó„É¨„Éü„Ç¢„É†‰∫àÊÉ≥</h2>
                        <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                            2‰Ωç„Äú5‰Ωç„ÅÆË©≥Á¥∞‰∫àÊÉ≥„Çí„ÅîË¶ß„ÅÑ„Åü„Å†„Åë„Åæ„Åô<br>
                            „Çà„ÇäÁ≤æÂ∫¶„ÅÆÈ´ò„ÅÑÁ´∂È¶¨‰∫àÊÉ≥„Çí„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑ
                        </p>
                        
                        <div style="
                            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
                            padding: 20px;
                            border-radius: 15px;
                            margin: 20px 0;
                        ">
                            <div style="font-size: 24px; font-weight: bold; color: #e17055;">¬•100</div>
                            <div style="color: #636e72; font-size: 14px;">‰∏ÄÂõûÈôê„Çä„ÅÆ„ÅäÊîØÊâï„ÅÑ</div>
                        </div>
                        
                        <!-- StripeÊ±∫Ê∏à„Éï„Ç©„Éº„É† -->
                        <div class="payment-form">
                            <label for="card-element">„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊÉÖÂ†±</label>
                            <div id="card-element" class="stripe-element">
                                <!-- Stripe Elements will create form elements here -->
                            </div>
                            <div id="card-errors" class="stripe-error" role="alert"></div>
                            
                            <button type="button" onclick="handlePayment()" id="submit-payment" style="
                                background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
                                color: white;
                                border: none;
                                padding: 15px 40px;
                                border-radius: 50px;
                                font-size: 18px;
                                font-weight: bold;
                                cursor: pointer;
                                width: 100%;
                                margin: 20px 0 15px 0;
                                transition: transform 0.3s;
                            " onmouseover="this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.transform='translateY(0)'">
                                üí≥ ¬•100„ÇíÊ±∫Ê∏à„Åô„Çã
                            </button>
                        </div>
                        
                        <p style="color: #999; font-size: 12px;">
                            üîí SSLÊöóÂè∑ÂåñÈÄö‰ø°„ÅßÂÆâÂÖ®„Å´Ê±∫Ê∏à„Åï„Çå„Åæ„Åô
                        </p>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            modal.style.display = 'block';
            
            // Stripe Elements„Çí„Éû„Ç¶„É≥„Éà
            setTimeout(() => {
                if (cardElement && document.getElementById('card-element')) {
                    try {
                        cardElement.mount('#card-element');
                        
                        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
                        cardElement.on('change', ({error}) => {
                            const displayError = document.getElementById('card-errors');
                            if (error) {
                                displayError.textContent = error.message;
                            } else {
                                displayError.textContent = '';
                            }
                        });
                    } catch (e) {
                        console.error('Card element mount error:', e);
                    }
                }
            }, 100);
        }

        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                // Stripe Elements„Çí„Ç¢„É≥„Éû„Ç¶„É≥„Éà
                if (cardElement) {
                    try {
                        cardElement.unmount();
                    } catch (e) {
                        console.error('Card element unmount error:', e);
                    }
                }
                modal.style.display = 'none';
            }
        }

        // StripeÊ±∫Ê∏àÂá¶ÁêÜÔºàNetlify FunctionsÂØæÂøúÁâàÔºâ
        async function handlePayment() {
            if (!stripe || !cardElement) {
                console.error('Stripe not initialized');
                return;
            }

            const submitButton = document.getElementById('submit-payment');
            const originalText = submitButton.innerHTML;
            
            submitButton.disabled = true;
            submitButton.innerHTML = 'üí≥ Âá¶ÁêÜ‰∏≠...';

            try {
                // Netlify Function„Åã„ÇâclientSecret„ÇíÂèñÂæó
                const response = await fetch('/.netlify/functions/create-payment-intent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: 100, // 100ÂÜÜ
                        currency: 'jpy'
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const { clientSecret } = await response.json();

                // Ê±∫Ê∏à„ÅÆÁ¢∫Ë™ç
                const {error, paymentIntent} = await stripe.confirmCardPayment(clientSecret, {
                    payment_method: {
                        card: cardElement,
                        billing_details: {
                            name: 'Á´∂È¶¨Âç†„ÅÑ„É¶„Éº„Ç∂„Éº',
                        },
                    }
                });

                if (error) {
                    // „Ç®„É©„ÉºË°®Á§∫
                    document.getElementById('card-errors').textContent = error.message;
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                    return;
                }

                // Ê±∫Ê∏àÊàêÂäü
                if (paymentIntent.status === 'succeeded') {
                    submitButton.innerHTML = '‚úÖ Ê±∫Ê∏àÂÆå‰∫ÜÔºÅ';
                    
                    // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„Å®„Éó„É¨„Éü„Ç¢„É†Ê©üËÉΩË°®Á§∫
                    setTimeout(() => {
                        closePremiumModal();
                        showFullRankings();
                    }, 1000);
                }

            } catch (err) {
                console.error('Payment error:', err);
                document.getElementById('card-errors').textContent = 'Ê±∫Ê∏àÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
            }
        }

        // ÂÖ®È†Ü‰Ωç„ÇíË°®Á§∫
        function showFullRankings() {
            const result = window.currentResult;
            if (!result || !result.rankings) return;
            
            const actualHorseContainer = document.getElementById('actualHorseContainer');
            
            // Êñ∞„Åó„ÅÑÂÆåÂÖ®Áâà„É©„É≥„Ç≠„É≥„Ç∞„Ç´„Éº„Éâ„Çí‰ΩúÊàê
            const fullRankingCard = document.createElement('div');
            fullRankingCard.className = 'actual-horse-card';
            fullRankingCard.style.background = 'linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%)';
            fullRankingCard.style.animation = 'slideIn 0.5s ease-out';
            
            fullRankingCard.innerHTML = `
                <div class="actual-horse-title">
                    üéâ ÂÆåÂÖ®‰∫àÊÉ≥ÁµêÊûú - „Éó„É¨„Éü„Ç¢„É†Áâà
                </div>
                <div style="text-align: left; line-height: 1.8; font-size: 16px; color: #2d3436;">
                    <div style="margin: 8px 0;"><strong>ü•á 1‰ΩçÔºàÊú¨ÂëΩÔºâ:</strong> <span style="color: #e17055; font-weight: bold;">${result.rankings.first}</span></div>
                    <div style="margin: 8px 0;"><strong>ü•à 2‰Ωç:</strong> <span style="color: #00b894; font-weight: bold;">${result.rankings.second}</span></div>
                    <div style="margin: 8px 0;"><strong>ü•â 3‰Ωç:</strong> <span style="color: #fdcb6e; font-weight: bold;">${result.rankings.third}</span></div>
                    <div style="margin: 8px 0;"><strong>üìç 4‰Ωç:</strong> <span style="color: #6c5ce7; font-weight: bold;">${result.rankings.fourth}</span></div>
                    <div style="margin: 8px 0;"><strong>üìç 5‰Ωç:</strong> <span style="color: #a29bfe; font-weight: bold;">${result.rankings.fifth}</span></div>
                </div>
                <div class="actual-horse-message" style="margin-top: 15px;">
                    ‚ú® „Éó„É¨„Éü„Ç¢„É†‰∫àÊÉ≥ÂÆå‰∫ÜÔºÅ„Åì„ÅÆÈ†Ü‰Ωç„Åå„ÅÇ„Å™„Åü„ÅÆÈÅãÂëΩ„ÅÆÁ≠î„Åà„Åß„Åô
                </div>
            `;
            
            // Êó¢Â≠ò„ÅÆ„Ç´„Éº„Éâ„ÇíÁΩÆ„ÅçÊèõ„Åà
            actualHorseContainer.innerHTML = '';
            actualHorseContainer.appendChild(fullRankingCard);
            
            // ÁµêÊûú„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´
            fullRankingCard.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>