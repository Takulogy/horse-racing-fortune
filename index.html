<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç«¶é¦¬ã®æœ¬å‘½é¦¬ã‚’å ã†Webã‚¢ãƒ—ãƒªã€‚æ˜Ÿåº§ã€è¡€æ¶²å‹ã€ãƒ¬ãƒ¼ã‚¹é¸æŠã§é‹å‘½ã®é¦¬ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼">
    <meta name="keywords" content="ç«¶é¦¬,å ã„,ç«¶é¦¬äºˆæƒ³,æœ¬å‘½é¦¬,å®å¡šè¨˜å¿µ,å®‰ç”°è¨˜å¿µ">
    <meta property="og:title" content="ğŸ‡ ç«¶é¦¬å ã„ - ã‚ãªãŸã®æœ¬å‘½é¦¬ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼">
    <meta property="og:description" content="æ˜Ÿåº§ã¨è¡€æ¶²å‹ã§é‹å‘½ã®æœ¬å‘½é¦¬ã‚’å ã„ã¾ã™">
    <meta property="og:type" content="website">
    <title>ğŸ‡ ç«¶é¦¬å ã„ - ã‚ãªãŸã®æœ¬å‘½é¦¬ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</title>
    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }

        .form-group select, .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .fortune-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 20px 0;
        }

        .fortune-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .fortune-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            display: none;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .horse-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .horse-number {
            font-size: 28px;
            font-weight: bold;
            color: #e17055;
            margin-bottom: 10px;
        }

        .horse-name {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }

        .fortune-message {
            color: #636e72;
            font-size: 14px;
            line-height: 1.6;
        }

        .reset-btn {
            background: #74b9ff;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .reset-btn:hover {
            background: #0984e3;
        }

        .loading {
            display: none;
            color: #667eea;
            font-size: 16px;
            margin: 20px 0;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .actual-horse-card {
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .actual-horse-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .actual-horse-name {
            font-size: 24px;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 8px;
        }

        .actual-horse-message {
            color: #636e72;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .fortune-btn {
                font-size: 16px;
                padding: 12px 30px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stripe Elements ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .stripe-element {
            background: white;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            margin: 10px 0;
            transition: border-color 0.3s;
        }

        .stripe-element.StripeElement--focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .stripe-element.StripeElement--invalid {
            border-color: #e74c3c;
        }

        .stripe-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }

        .payment-form {
            text-align: left;
            margin: 20px 0;
        }

        .payment-form label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        /* è¡¨ç´™ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .cover-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: -30px;
            border-radius: 20px;
            padding: 30px;
        }

        .cover-content {
            z-index: 2;
            position: relative;
        }

        .cover-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .cover-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .cover-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .cover-features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 40px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 18px;
            background: rgba(255,255,255,0.1);
            padding: 12px 25px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .feature-icon {
            font-size: 24px;
        }

        .start-btn {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 234, 167, 0.3);
            margin-bottom: 20px;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 234, 167, 0.4);
        }

        .cover-note {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 10px;
        }

        .floating-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .floating-element {
            position: absolute;
            font-size: 30px;
            animation: float 6s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        @media (max-width: 768px) {
            .cover-icon {
                font-size: 60px;
            }
            
            .cover-title {
                font-size: 36px;
            }
            
            .cover-subtitle {
                font-size: 18px;
            }
            
            .start-btn {
                font-size: 18px;
                padding: 15px 40px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- è¡¨ç´™ãƒšãƒ¼ã‚¸ -->
        <div id="coverPage" class="cover-page">
            <div class="cover-content">
                <div class="cover-icon">ğŸ‡</div>
                <h1 class="cover-title">ç«¶é¦¬å ã„</h1>
                <p class="cover-subtitle">ã‚ãªãŸã®é‹å‘½ã®æœ¬å‘½é¦¬ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</p>
                
                <div class="cover-features">
                    <div class="feature-item">
                        <span class="feature-icon">â­</span>
                        <span>æ˜Ÿåº§ã¨è¡€æ¶²å‹ã§å ã†</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ¯</span>
                        <span>å®Ÿéš›ã®ãƒ¬ãƒ¼ã‚¹å‡ºèµ°é¦¬</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ’</span>
                        <span>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ äºˆæƒ³Â¥100</span>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startApp()">
                    ğŸ”® å ã„ã‚’å§‹ã‚ã‚‹
                </button>
                
                <p class="cover-note">
                    1ä½äºˆæƒ³ã¯ç„¡æ–™ï¼2-5ä½ã®è©³ç´°äºˆæƒ³ã¯Â¥100
                </p>
            </div>
            
            <div class="floating-elements">
                <div class="floating-element" style="top: 10%; left: 15%; animation-delay: 0s;">ğŸ</div>
                <div class="floating-element" style="top: 20%; right: 20%; animation-delay: 1s;">â­</div>
                <div class="floating-element" style="bottom: 30%; left: 10%; animation-delay: 2s;">ğŸ†</div>
                <div class="floating-element" style="bottom: 20%; right: 15%; animation-delay: 3s;">ğŸ¯</div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª -->
        <div id="mainApp" style="display: none;">
            <div class="header">
                <h1>ğŸ‡ ç«¶é¦¬å ã„</h1>
                <p>ã‚ãªãŸã®é‹å‘½ã®æœ¬å‘½é¦¬ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ï¼</p>
            </div>

        <form id="fortuneForm" action="javascript:void(0);">
            <div class="form-group">
                <label for="zodiac">æ˜Ÿåº§ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                <select id="zodiac" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="aries">ç‰¡ç¾Šåº§ (3/21-4/19)</option>
                    <option value="taurus">ç‰¡ç‰›åº§ (4/20-5/20)</option>
                    <option value="gemini">åŒå­åº§ (5/21-6/21)</option>
                    <option value="cancer">èŸ¹åº§ (6/22-7/22)</option>
                    <option value="leo">ç…å­åº§ (7/23-8/22)</option>
                    <option value="virgo">ä¹™å¥³åº§ (8/23-9/22)</option>
                    <option value="libra">å¤©ç§¤åº§ (9/23-10/23)</option>
                    <option value="scorpio">è åº§ (10/24-11/22)</option>
                    <option value="sagittarius">å°„æ‰‹åº§ (11/23-12/21)</option>
                    <option value="capricorn">å±±ç¾Šåº§ (12/22-1/19)</option>
                    <option value="aquarius">æ°´ç“¶åº§ (1/20-2/18)</option>
                    <option value="pisces">é­šåº§ (2/19-3/20)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="bloodType">è¡€æ¶²å‹ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                <select id="bloodType" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="A">Aå‹</option>
                    <option value="B">Bå‹</option>
                    <option value="O">Oå‹</option>
                    <option value="AB">ABå‹</option>
                </select>
            </div>

            <div class="form-group">
                <label for="targetRace">ã‚ãªãŸã®ä»Šå›Ã—ç«¶é¦¬ã¯ä½•ã§ã™ã‹ï¼Ÿ</label>
                <select id="targetRace" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="takarazuka">å®å¡šè¨˜å¿µ (6/15 é˜ªç¥)</option>
                    <option value="yasuda">å®‰ç”°è¨˜å¿µ (6/8 æ±äº¬) â€»çµ‚äº†</option>
                    <option value="derby">æ—¥æœ¬ãƒ€ãƒ¼ãƒ“ãƒ¼ (6/1 æ±äº¬) â€»çµ‚äº†</option>
                    <option value="oaks">ã‚ªãƒ¼ã‚¯ã‚¹ (5/25 æ±äº¬) â€»çµ‚äº†</option>
                    <option value="victoria">ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢ãƒã‚¤ãƒ« (5/11 æ±äº¬) â€»çµ‚äº†</option>
                    <option value="tennosho_spring">å¤©çš‡è³(æ˜¥) (4/27 äº¬éƒ½) â€»çµ‚äº†</option>
                    <option value="oka_sho">æ¡œèŠ±è³ (4/6 é˜ªç¥) â€»çµ‚äº†</option>
                    <option value="satsuki_sho">çšæœˆè³ (4/13 ä¸­å±±) â€»çµ‚äº†</option>
                </select>
            </div>

            <div class="form-group">
                <label for="luckyNumber">ä»Šæ—¥ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼ (1-18)</label>
                <input type="number" id="luckyNumber" min="1" max="18" required placeholder="1ã‹ã‚‰18ã®æ•°å­—ã‚’å…¥åŠ›">
            </div>

            <button type="button" class="fortune-btn" onclick="startFortune()">ğŸ”® æœ¬å‘½é¦¬ã‚’å ã†</button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            é‹å‘½ã®é¦¬ã‚’æ¢ç´¢ä¸­...
        </div>

        <div class="result-container" id="result">
            <div class="result-title">ğŸ¯ ã‚ãªãŸã®æœ¬å‘½ã¯ã“ã¡ã‚‰ï¼</div>
            <div class="horse-card" id="horseCard">
                <div class="horse-number" id="horseNumber"></div>
                <div class="horse-name" id="horseName"></div>
                <div class="fortune-message" id="fortuneMessage"></div>
            </div>
            <div id="actualHorseContainer"></div>
            <button class="reset-btn" onclick="resetForm()">ã‚‚ã†ä¸€åº¦å ã†</button>
        </div>
    </div>

    <script>
        // Stripeå…¬é–‹éµï¼ˆæ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰
        const STRIPE_PUBLIC_KEY = 'pk_test_51RhtyeCk5JGiuAKupKRqpZr7IajPez21srAHY8JGxqpJanb3nvoBJTVvDsocOqCGTHayR8sI3kbM2ysOqam72wVd008s7jnbKU';
        
        let stripe;
        let elements;
        let cardElement;

        // å®Ÿéš›ã®ãƒ¬ãƒ¼ã‚¹å‡ºèµ°é¦¬ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const raceHorses = {
            'takarazuka': [
                'ãƒ™ãƒ©ã‚¸ã‚ªã‚ªãƒšãƒ©', 'ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ«ãƒ¬ã‚¤', 'ãƒ¬ã‚¬ãƒ¬ã‚¤ãƒ©', 'ã‚¢ãƒ¼ãƒãƒ³ã‚·ãƒƒã‚¯', 
                'ãƒ‰ã‚¥ãƒ¬ãƒƒãƒ„ã‚¡', 'ãƒ¨ãƒ¼ãƒ›ãƒ¼ãƒ¬ã‚¤ã‚¯', 'ã‚¸ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ãƒ‘ãƒ¬ã‚¹', 'ã‚·ãƒ§ã‚¦ãƒŠãƒ³ãƒ©ãƒ—ãƒ³ã‚¿',
                'ãƒ¡ã‚¤ã‚·ãƒ§ã‚¦ã‚¿ãƒãƒ«', 'ã‚½ãƒ¼ãƒ«ã‚ªãƒªã‚¨ãƒ³ã‚¹', 'ãƒ­ãƒ¼ã‚·ãƒ£ãƒ ãƒ‘ãƒ¼ã‚¯', 'ãƒ€ãƒãƒ³ãƒ™ãƒ«ãƒ¼ã‚¬',
                'ãƒªãƒ“ã‚¢ãƒ³ã‚°ãƒ©ã‚¹', 'ãƒœãƒ«ãƒ‰ã‚°ãƒ•ãƒ¼ã‚·ãƒ¥', 'ãƒãƒ£ãƒƒã‚¯ãƒã‚¤ãƒˆ', 'ã‚¸ãƒ¥ãƒ¼ãƒ³ãƒ†ã‚¤ã‚¯',
                'ã‚·ãƒ¥ãƒ´ã‚¡ãƒªã‚¨ãƒ­ãƒ¼ã‚º', 'ãƒ—ãƒ©ãƒ€ãƒªã‚¢'
            ],
            'yasuda': [
                'ã‚¸ãƒ£ãƒ³ã‚¿ãƒ«ãƒãƒ³ã‚¿ãƒ«', 'ã‚¬ã‚¤ã‚¢ãƒ•ã‚©ãƒ¼ã‚¹', 'ã‚½ã‚¦ãƒ«ãƒ©ãƒƒã‚·ãƒ¥', 'ãƒ–ãƒ¬ã‚¤ãƒ‡ã‚£ãƒ´ã‚§ãƒ¼ã‚°',
                'ã‚·ãƒƒã‚¯ã‚¹ãƒšãƒ³ã‚¹', 'ã‚¸ãƒ¥ãƒ³ãƒ–ãƒ­ãƒƒã‚µãƒ ', 'ãƒãƒƒãƒ‰ã‚¯ãƒ¼ãƒ«', 'ã‚¦ã‚¤ãƒ³ãƒãƒ¼ãƒ™ãƒ«',
                'ãƒˆãƒ­ãƒ´ã‚¡ãƒˆãƒ¼ãƒ¬', 'ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³ã‚«ãƒ©ãƒ¼', 'ã‚¨ã‚³ãƒ­ãƒ´ã‚¡ãƒ«ãƒ„', 'ãƒ—ãƒªãƒ†ã‚£ã‚¢ãƒ³ã‚¸ã‚§ãƒ«',
                'ãƒ´ã‚§ãƒ­ãƒ¼ãƒŠã‚·ãƒãƒ¼', 'ã‚¹ãƒ¬ãƒ¼ãƒˆãƒ‡ã‚¸ã‚¿ãƒ«', 'ãƒã‚¤ã‚ªã‚¹ãƒ•ã‚£ã‚¢', 'ãƒŠãƒ ãƒ©ã‚¯ãƒ¬ã‚¢',
                'ãƒ¢ãƒ¼ãƒ‰ãƒ–ãƒªãƒ¼ã‚º', 'ãƒ¬ã‚¸ãƒ¼ãƒŠãƒ¡ãƒƒã‚»'
            ],
            'derby': [
                'ã‚¯ãƒ­ãƒ¯ãƒ‡ãƒ¥ãƒãƒ¼ãƒ«', 'ã‚¢ãƒªã‚¹ãƒˆãƒ†ãƒ¬ã‚¹', 'ã‚·ãƒ§ã‚¦ãƒŠãƒ³ãƒãƒƒã‚­ãƒ¼', 'ãƒ¬ã‚¾ãƒŠãƒ³ã‚¹',
                'ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒªãƒãƒ¼', 'ã‚·ãƒ³ã‚¨ãƒ³ãƒšãƒ©ãƒ¼', 'ãƒ›ã‚¦ã‚ªã‚¦ã‚¬ã‚¤ã‚¢', 'ã‚¢ãƒ‰ãƒã‚¤ãƒ¤ãƒ™ãƒ«ã‚¯',
                'ã‚¹ãƒ†ãƒ©ãƒªã‚¢', 'ã‚µãƒ¼ãƒãƒ«ã‚¨ãƒŠã‚¸ãƒ¼', 'ãƒ–ãƒ«ãƒ¼ãƒŸãƒ³ã‚°ã‚¹ã‚«ã‚¤', 'ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢',
                'ãƒ€ãƒ³ãƒ„ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰', 'ã‚µãƒ©ãƒ–ãƒ¬ãƒ‰ãƒ‘ã‚¤', 'ãƒšã‚¬ã‚µã‚¹ãƒ†ãƒ¼ãƒ«', 'ã‚·ãƒ«ãƒãƒ¼ã‚¦ã‚£ãƒ³ã‚°ã‚¹',
                'ã‚³ã‚¹ãƒ¢ãƒ†ã‚£ã‚¢ãƒ©', 'ãƒ¬ãƒ‡ã‚£ãƒ¼ãƒ­ãƒ¼ã‚º'
            ],
            'oaks': [
                'ãƒ©ã‚¤ãƒˆãƒãƒƒã‚¯', 'ã‚¯ãƒ¬ãƒ ã‚¹ãƒ‡ã‚£ã‚ª', 'ãƒ¬ã‚¬ãƒ¬ã‚¤ãƒ©', 'ãƒãƒ¼ãƒ™ãƒ«ã‚¹ãƒã‚¤ãƒ«',
                'ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¦ã‚¹', 'ãƒ€ã‚¹ãƒˆãƒ‡ãƒ“ãƒ«', 'ãƒãƒªã‚½ãƒ¼ãƒ—', 'ã‚¢ã‚ºã‚µãƒ³',
                'ã‚·ãƒ¼ãƒ‹ãƒƒã‚¯ã‚¬ãƒ¼ãƒ‡ãƒ³', 'ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼', 'ã‚¢ãƒ¼ãƒˆã‚²ãƒ«', 'ã‚³ã‚¹ãƒ¢ãƒ–ãƒ«ãƒ¼',
                'ãƒã‚¤ãƒ˜ãƒƒãƒ‰', 'ãƒ€ãƒ¼ã‚¯ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¦ã‚£ãƒ³ã‚°', 'ã‚¹ã‚¿ãƒ¼ãƒ©ã‚¤ãƒˆ',
                'ã‚¢ãƒ™ãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒˆ', 'ãƒ©ãƒ–ãƒªãƒ¼ãƒ—ãƒªãƒ³ã‚»ã‚¹'
            ],
            'victoria': [
                'ãƒ¬ã‚¬ãƒ¬ã‚¤ãƒ©', 'ãƒ–ãƒ¬ã‚¤ãƒ‡ã‚£ãƒ´ã‚§ãƒ¼ã‚°', 'ã‚·ãƒƒã‚¯ã‚¹ãƒšãƒ³ã‚¹', 'ã‚¢ã‚«ã‚¤ãƒˆãƒªãƒãƒ ã‚¹ãƒ¡',
                'ãƒªãƒãƒ†ã‚£ã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰', 'ã‚µãƒ³ã‚¯ãƒ†ãƒ¥ã‚¨ãƒ¼ãƒ«', 'ã‚½ãƒ¼ãƒ´ã‚¡ãƒªã‚¢ãƒ³ãƒˆ', 'ãƒ¢ãƒ¼ãƒªã‚¹',
                'ãƒŠã‚¹ãƒãƒ¦ãƒ¡', 'ãƒªãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°', 'ã‚¹ãƒˆãƒ¼ãƒŸãƒ¼ã‚·ãƒ¼', 'ã‚¢ãƒ«ã‚¢ã‚¤ãƒ³',
                'ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆã‚«ãƒ©ãƒ¼', 'ãƒ¡ã‚¤ã‚±ã‚¤ã‚¨ãƒ¼ãƒ«', 'ãƒ—ãƒªãƒ†ã‚£ã‚¢ãƒ³ã‚¸ã‚§ãƒ«', 'ãƒªã‚ªãƒ³ãƒªã‚ªãƒ³',
                'ãƒ´ã‚§ãƒ­ãƒ‹ã‚«', 'ã‚·ãƒ«ãƒ“ã‚¢ãƒ³'
            ],
            'tennosho_spring': [
                'ãƒ¬ã‚¬ãƒ¬ã‚¤ãƒ©', 'ã‚·ãƒ§ã‚¦ãƒŠãƒ³ãƒ©ãƒ—ãƒ³ã‚¿', 'ãƒ´ã‚§ãƒ­ãƒ¼ãƒŠã‚·ãƒãƒ¼', 'ã‚¿ã‚¤ãƒˆãƒ«ãƒ›ãƒ«ãƒ€ãƒ¼',
                'ã‚¹ãƒ¬ãƒ¼ãƒˆãƒ‡ã‚¸ã‚¿ãƒ«', 'ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒªãƒ’ãƒˆ', 'ã‚¢ãƒ´ã‚¡ãƒ³ã‚»', 'ã‚­ãƒ³ã‚°ã‚¹ã‚ªãƒ¼ãƒ€ãƒ¼',
                'ãƒ†ãƒ³ãƒã‚¤ãƒ³ãƒˆ', 'ã‚´ãƒ¼ãƒ«ãƒ‰ã‚¢ã‚¯ã‚¿ãƒ¼', 'ã‚¦ã‚·ãƒ¥ãƒãƒ†ã‚½ãƒ¼ãƒ­', 'ãƒ‰ã‚¥ãƒ¬ãƒƒãƒ„ã‚¢',
                'ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒ—ãƒ¬ãƒŸã‚¢', 'ãƒ–ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹', 'ã‚½ãƒ¼ãƒ«ã‚ªãƒªã‚¨ãƒ³ã‚¹', 'ã‚¨ãƒ¼ãƒ‡ãƒ«ãƒ¯ã‚¤ã‚¼',
                'ã‚·ãƒ¥ãƒ«ãƒ´ã‚£ãƒ³', 'ã‚¹ãƒšã‚¯ã‚¿ã‚¯ãƒ«'
            ],
            'oka_sho': [
                'ãƒ©ã‚¤ãƒˆãƒãƒƒã‚¯', 'ãƒ¬ã‚¬ãƒ¬ã‚¤ãƒ©', 'ã‚¯ãƒ¬ãƒ ã‚¹ãƒ‡ã‚£ã‚ª', 'ãƒ©ã‚¤ãƒ•ãƒãƒ³ã‚¯ãƒ¼',
                'ãƒˆã‚¥ãƒ‰ã‚¢ãƒ—ãƒ©ã‚¤ãƒ ', 'ã‚½ãƒ•ã‚£ã‚¢ãƒ©ã‚¤ãƒ–', 'ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ‡ãƒ«', 'ã‚´ãƒ¼ãƒ«ãƒ‰ãƒãƒ³ã‚¿ãƒ¼',
                'ãƒ‹ã‚·ãƒã‚³ãƒ³ã‚­ã‚¹ã‚¿', 'ãƒãƒ¼ãƒ™ãƒ«ã‚¹ãƒã‚¤ãƒ«', 'ã‚¨ãƒ ãƒ†ã‚£ãƒ¼ãƒ“ãƒ¼', 'ãƒªãƒªã‚«ãƒ«ãƒ›ãƒ¯ã‚¤ãƒˆ',
                'ã‚µã‚¯ãƒ©ãƒ—ãƒ­ãƒŸã‚¹', 'ãƒ“ã‚¢ãƒ³ã‚«', 'ãƒ”ãƒ³ã‚¯ã‚«ãƒ¡ãƒãƒ¡ãƒ', 'ã‚½ãƒªã‚¿ãƒªãƒ¼',
                'ã‚°ãƒ©ãƒ³ãƒ‰ã‚¹ãƒ©ãƒ ', 'ãƒ¬ãƒ‡ã‚£ãƒ¼ãƒ•ãƒ¬ã‚¤'
            ],
            'satsuki_sho': [
                'ã‚¢ãƒªã‚¹ãƒˆãƒ†ãƒ¬ã‚¹', 'ã‚·ãƒ§ã‚¦ãƒŠãƒ³ãƒãƒƒã‚­ãƒ¼', 'ãƒ¬ã‚¾ãƒŠãƒ³ã‚¹', 'ã‚·ãƒ³ã‚¨ãƒ³ãƒšãƒ©ãƒ¼',
                'ã‚¢ãƒ‰ãƒã‚¤ãƒ¤ãƒ™ãƒ«ã‚¯', 'ãƒ–ãƒ«ãƒ¼ãƒŸãƒ³ã‚°ã‚¹ã‚«ã‚¤', 'ãƒ€ãƒ³ãƒ„ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰', 'ã‚¢ã‚¹ã‚¯ãƒ‰ãƒªãƒ¼ãƒ ã‚¹',
                'ã‚³ã‚ºãƒŸãƒƒã‚¯ãƒ•ã‚©ãƒ¼ã‚¹', 'ãƒ›ã‚¦ã‚ªã‚¦ã‚¬ã‚¤ã‚¢', 'ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢', 'ã‚µãƒ¼ãƒãƒ«ã‚¨ãƒŠã‚¸ãƒ¼',
                'ãƒšã‚¬ã‚µã‚¹ãƒ†ãƒ¼ãƒ«', 'ãƒˆãƒ¼ã‚»ãƒ³ã‚¢ãƒ©ãƒ³', 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹', 'ã‚¨ã‚¢ãƒ•ã‚©ãƒ¼ã‚¹',
                'ã‚·ãƒ«ãƒãƒ¼ã‚¦ã‚£ãƒ³ã‚°ã‚¹', 'ãƒ­ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ¼ãƒ '
            ]
        };

        // å ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå¯¾è±¡ãƒ¬ãƒ¼ã‚¹åˆ¥ï¼‰
        const raceSpecificMessages = {
            'takarazuka': [
                "å®å¡šè¨˜å¿µã¯ä¸ŠåŠæœŸã®é ‚ç‚¹ã‚’æ±ºã‚ã‚‹ä¸€æˆ¦ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«æ „å…‰ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚",
                "é˜ªç¥ç«¶é¦¬å ´ã®å‚ã‚’åˆ¶ã™ã‚‹ã®ã¯ã“ã®é¦¬ã§ã™ã€‚ã‚ãªãŸã®å¿œæ´ãŒå‹åˆ©ã¸ã®éµã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚",
                "ãƒ•ã‚¡ãƒ³æŠ•ç¥¨ã®å®å¡šè¨˜å¿µã€ã‚ãªãŸã®å¿ƒãŒé¸ã‚“ã ã“ã®é¦¬ãŒå¥‡è·¡ã‚’èµ·ã“ã—ã¾ã™ã€‚"
            ],
            'yasuda': [
                "å®‰ç”°è¨˜å¿µã¯ãƒã‚¤ãƒ«ç‹æ±ºå®šæˆ¦ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«é€Ÿã•ã¨èˆˆå¥®ã‚’å±Šã‘ã¦ãã‚Œã¾ã—ãŸã€‚",
                "æ±äº¬1600mã‚’åˆ¶ã—ãŸã“ã®é¦¬ã€ã‚ãªãŸã®ç›´æ„ŸåŠ›ã®è¨¼æ˜ã§ã™ã€‚",
                "ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ç¥­å…¸ã§é¸ã°ã‚Œã—ã“ã®é¦¬ã€ç´ æ™´ã‚‰ã—ã„çµæœã ã£ãŸã¯ãšã§ã™ã€‚"
            ],
            'derby': [
                "æ—¥æœ¬ãƒ€ãƒ¼ãƒ“ãƒ¼ã¯3æ­³é¦¬ã®æœ€é«˜å³°ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã®æ„Ÿå‹•ã‚’ã‚‚ãŸã‚‰ã—ã¾ã—ãŸã€‚",
                "åºœä¸­ã®ç›´ç·šã‚’é§†ã‘æŠœã‘ãŸã“ã®é¦¬ã€ã‚ãªãŸã®é’æ˜¥ã®1ãƒšãƒ¼ã‚¸ã‚’é£¾ã£ãŸã¯ãšã§ã™ã€‚",
                "ãƒ€ãƒ¼ãƒ“ãƒ¼é¦¬ã¯ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«æ°¸é ã®æ€ã„å‡ºã‚’æ®‹ã—ã¦ãã‚Œã¾ã—ãŸã€‚"
            ],
            'oaks': [
                "ã‚ªãƒ¼ã‚¯ã‚¹ã¯ç‰é¦¬ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã®é ‚ç‚¹ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«å¥³ç‹ã®è¼ãã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚",
                "ç¾ã—ãç‰é¦¬ã®æˆ¦ã„ã€ã“ã®é¦¬ãŒã‚ãªãŸã®å¿ƒã‚’é­…äº†ã™ã‚‹ã§ã—ã‚‡ã†ã€‚",
                "æ¡œèŠ±è³ã«ç¶šãæ „å…‰ã¸ã®é“ã€ã“ã®é¦¬ãŒã‚ãªãŸã¨å…±ã«æ­©ã¿ã¾ã™ã€‚"
            ],
            'victoria': [
                "ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢ãƒã‚¤ãƒ«ã¯æ˜¥ã®å¥³ç‹æ±ºå®šæˆ¦ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«å‹åˆ©ã®å¥³ç¥ã‚’å±Šã‘ã¾ã™ã€‚",
                "ç‰é¦¬ãƒã‚¤ãƒ«ç‹è€…ã®è¨¼ã€ã“ã®é¦¬ãŒã‚ãªãŸã®ãƒ—ãƒ©ã‚¤ãƒ‰ã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚",
                "æ±äº¬èŠ1600mã‚’åˆ¶ã™ã‚‹å¥³å‚‘ã€ã“ã®é¦¬ãŒã‚ãªãŸã«åŠ›å¼·ã•ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚"
            ],
            'tennosho_spring': [
                "å¤©çš‡è³æ˜¥ã¯é•·è·é›¢ç‹ã®è¨¼ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«æŒä¹…åŠ›ã¨ç²˜ã‚Šå¼·ã•ã‚’æˆã‘ã¾ã™ã€‚",
                "äº¬éƒ½3200mã®æ¿€é—˜ã€ã“ã®é¦¬ãŒã‚ãªãŸã®å¿è€åŠ›ã‚’ç‰©èªã£ã¦ã„ã¾ã™ã€‚",
                "æ˜¥ã®ç›¾ã‚’æ‰‹ã«ã™ã‚‹è€…ã€ã“ã®é¦¬ãŒã‚ãªãŸã«æœ€é«˜ã®æ „èª‰ã‚’ã‚‚ãŸã‚‰ã™ã§ã—ã‚‡ã†ã€‚"
            ],
            'oka_sho': [
                "æ¡œèŠ±è³ã¯ç‰é¦¬ã‚¯ãƒ©ã‚·ãƒƒã‚¯ç¬¬ä¸€å¼¾ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«æ˜¥ã®æ¯å¹ã‚’å±Šã‘ã¾ã™ã€‚",
                "3æ­³ç‰é¦¬ã®é ‚ç‚¹ã‚’æ±ºã‚ã‚‹æˆ¦ã„ã€ã“ã®é¦¬ãŒã‚ãªãŸã®æ–°ãŸãªå‡ºç™ºã‚’ç¥ç¦ã—ã¾ã™ã€‚",
                "æ¡œå’²ãé˜ªç¥ã§è¼ãå¥³ç‹ã€ã“ã®é¦¬ãŒã‚ãªãŸã«ç¾ã—ã„æœªæ¥ã‚’ç´„æŸã—ã¦ãã‚Œã¾ã™ã€‚"
            ],
            'satsuki_sho': [
                "çšæœˆè³ã¯ã‚¯ãƒ©ã‚·ãƒƒã‚¯é–‹å¹•æˆ¦ï¼ã“ã®é¦¬ãŒã‚ãªãŸã«æ–°ç·‘ã®åŠ›ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚",
                "3æ­³ç‰¡é¦¬ã®ç¬¬ä¸€é–¢é–€ã€ã“ã®é¦¬ãŒã‚ãªãŸã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç²¾ç¥ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚",
                "ä¸­å±±èŠ2000mã‚’åˆ¶ã™ã‚‹è‹¥æ­¦è€…ã€ã“ã®é¦¬ãŒã‚ãªãŸã«å‹‡æ°—ã‚’ã‚‚ãŸã‚‰ã™ã§ã—ã‚‡ã†ã€‚"
            ]
        };

        const defaultMessages = [
            "ä»Šæ—¥ã®ã‚ãªãŸã«ã¯å‹åˆ©ã®é¢¨ãŒå¹ã„ã¦ã„ã¾ã™ã€‚ã“ã®é¦¬ãŒã‚ãªãŸã«å¹¸é‹ã‚’ã‚‚ãŸã‚‰ã™ã§ã—ã‚‡ã†ã€‚",
            "æ˜Ÿã®é…ç½®ãŒã‚ãªãŸã¨ã“ã®é¦¬ã®çµ†ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ä¿¡ã˜ã¦å¿œæ´ã—ã¾ã—ã‚‡ã†ã€‚",
            "ã‚ãªãŸã®ç›´æ„ŸåŠ›ãŒæœ€é«˜æ½®ã«é”ã—ã¦ã„ã¾ã™ã€‚ã“ã®é¦¬ãŒå¥‡è·¡ã‚’èµ·ã“ã™ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
            "é‹å‘½ã®æ­¯è»ŠãŒå‹•ãå§‹ã‚ã¾ã—ãŸã€‚ã“ã®é¦¬ãŒã‚ãªãŸã®æœŸå¾…ã«å¿œãˆã¦ãã‚Œã‚‹ã¯ãšã§ã™ã€‚",
            "ä»Šæ—¥ã®ã‚ãªãŸã®ã‚ªãƒ¼ãƒ©ã¯ç‰¹åˆ¥ã§ã™ã€‚ã“ã®é¦¬ã¨å…±ã«æ „å…‰ã‚’æ´ã¿ã¾ã—ã‚‡ã†ã€‚",
            "å®‡å®™ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒã“ã®é¦¬ã«é›†ä¸­ã—ã¦ã„ã¾ã™ã€‚å¤§ããªå¯èƒ½æ€§ã‚’ç§˜ã‚ã¦ã„ã¾ã™ã€‚",
            "ã‚ãªãŸã®å¿ƒã®å£°ãŒã“ã®é¦¬ã‚’é¸ã³ã¾ã—ãŸã€‚ãã£ã¨ç´ æ™´ã‚‰ã—ã„çµæœãŒå¾…ã£ã¦ã„ã¾ã™ã€‚",
            "ä»Šæ—¥ã¯ç‰¹åˆ¥ãªæ—¥ã§ã™ã€‚ã“ã®é¦¬ãŒã‚ãªãŸã«äºˆæƒ³ã‚’è¶…ãˆã‚‹å–œã³ã‚’ã‚‚ãŸã‚‰ã™ã§ã—ã‚‡ã†ã€‚"
        ];

        // StripeåˆæœŸåŒ–
        function initializeStripe() {
            if (typeof Stripe !== 'undefined') {
                stripe = Stripe(STRIPE_PUBLIC_KEY);
                elements = stripe.elements();
                
                // ã‚«ãƒ¼ãƒ‰è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«
                const cardStyle = {
                    style: {
                        base: {
                            fontSize: '16px',
                            color: '#424770',
                            '::placeholder': {
                                color: '#aab7c4',
                            },
                        },
                        invalid: {
                            color: '#9e2146',
                        },
                    },
                };
                
                cardElement = elements.create('card', cardStyle);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«StripeåˆæœŸåŒ–
        window.addEventListener('load', initializeStripe);

        // è¡¨ç´™ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¸ã®ç§»è¡Œ
        function startApp() {
            document.getElementById('coverPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        function startFortune() {
            const zodiac = document.getElementById('zodiac').value;
            const bloodType = document.getElementById('bloodType').value;
            const targetRace = document.getElementById('targetRace').value;
            const luckyNumber = parseInt(document.getElementById('luckyNumber').value);

            if (!zodiac || !bloodType || !targetRace || !luckyNumber) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.querySelector('.fortune-btn').disabled = true;

            // å ã„è¨ˆç®—ï¼ˆ2ç§’å¾Œã«çµæœè¡¨ç¤ºï¼‰
            setTimeout(() => {
                const result = calculateFortune(zodiac, bloodType, targetRace, luckyNumber);
                displayResult(result);
            }, 2000);
        }

        function calculateFortune(zodiac, bloodType, targetRace, luckyNumber) {
            // å ã„ãƒ­ã‚¸ãƒƒã‚¯
            let seed = 0;
            
            // æ˜Ÿåº§ã«ã‚ˆã‚‹åŸºæœ¬æ•°å€¤
            const zodiacValues = {
                'aries': 1, 'taurus': 2, 'gemini': 3, 'cancer': 4,
                'leo': 5, 'virgo': 6, 'libra': 7, 'scorpio': 8,
                'sagittarius': 9, 'capricorn': 10, 'aquarius': 11, 'pisces': 12
            };
            
            // è¡€æ¶²å‹ã«ã‚ˆã‚‹ä¿‚æ•°
            const bloodTypeValues = {
                'A': 3, 'B': 7, 'O': 11, 'AB': 13
            };

            // å¯¾è±¡ãƒ¬ãƒ¼ã‚¹ã«ã‚ˆã‚‹è£œæ­£å€¤
            const raceValues = {
                'takarazuka': 5, 'yasuda': 8, 'derby': 12, 'oaks': 9,
                'victoria': 6, 'tennosho_spring': 15, 'oka_sho': 4, 'satsuki_sho': 7
            };

            seed = (zodiacValues[zodiac] * bloodTypeValues[bloodType] + raceValues[targetRace] + luckyNumber) % 18 + 1;
            
            // é¸æŠã•ã‚ŒãŸãƒ¬ãƒ¼ã‚¹ã®å‡ºèµ°é¦¬ã‹ã‚‰æœ¬å‘½ã‚’é¸æŠ
            const raceHorsesList = raceHorses[targetRace] || [];
            const horseIndex = (seed - 1) % raceHorsesList.length;
            const horseName = raceHorsesList[horseIndex];
            
            // ä»–ã®é †ä½ã®é¦¬ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§é¸æŠï¼ˆæœ¬å‘½ä»¥å¤–ã‹ã‚‰ï¼‰
            const otherHorses = raceHorsesList.filter((_, index) => index !== horseIndex);
            const shuffledHorses = [...otherHorses].sort(() => Math.random() - 0.5);
            
            const rankings = {
                first: horseName,
                second: shuffledHorses[0] || 'æœªå®š',
                third: shuffledHorses[1] || 'æœªå®š',
                fourth: shuffledHorses[2] || 'æœªå®š',
                fifth: shuffledHorses[3] || 'æœªå®š'
            };
            
            // å¯¾è±¡ãƒ¬ãƒ¼ã‚¹åˆ¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
            const messages = raceSpecificMessages[targetRace] || defaultMessages;
            const message = messages[Math.floor(Math.random() * messages.length)];

            return {
                number: seed,
                name: horseName,
                message: message,
                race: targetRace,
                rankings: rankings
            };
        }

        function displayResult(result) {
            document.getElementById('loading').style.display = 'none';
            
            document.getElementById('horseNumber').textContent = `1ä½ï¼ˆæœ¬å‘½ï¼‰`;
            document.getElementById('horseName').textContent = result.name;
            document.getElementById('fortuneMessage').textContent = result.message;
            
            // é †ä½äºˆæƒ³ã‚’è¡¨ç¤ºã™ã‚‹éƒ¨åˆ†ï¼ˆ1ä½ã®ã¿è¡¨ç¤ºã€2-5ä½ã¯éš ã™ï¼‰
            const actualHorseContainer = document.getElementById('actualHorseContainer');
            actualHorseContainer.innerHTML = ''; // ã‚¯ãƒªã‚¢
            
            if (result.rankings) {
                const rankingCard = document.createElement('div');
                rankingCard.className = 'actual-horse-card';
                
                rankingCard.innerHTML = `
                    <div class="actual-horse-title">
                        ğŸ† ã‚ãªãŸã®äºˆæƒ³é †ä½
                    </div>
                    <div style="text-align: left; line-height: 1.8; font-size: 16px; color: #2d3436;">
                        <div style="margin: 8px 0;"><strong>ğŸ¥‡ 1ä½ï¼ˆæœ¬å‘½ï¼‰:</strong> <span style="color: #e17055; font-weight: bold;">${result.rankings.first}</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ğŸ¥ˆ 2ä½:</strong> <span style="color: #666;">â—‹â—‹â—‹â—‹â—‹â—‹</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ğŸ¥‰ 3ä½:</strong> <span style="color: #666;">â—‹â—‹â—‹â—‹â—‹â—‹</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ğŸ“ 4ä½:</strong> <span style="color: #666;">â—‹â—‹â—‹â—‹â—‹â—‹</span></div>
                        <div style="margin: 8px 0; opacity: 0.5;"><strong>ğŸ“ 5ä½:</strong> <span style="color: #666;">â—‹â—‹â—‹â—‹â—‹â—‹</span></div>
                    </div>
                    <div class="actual-horse-message" style="margin-top: 15px;">
                        1ä½ã®æœ¬å‘½é¦¬ã¯ã‚ãªãŸã®é‹å‘½ãŒé¸ã‚“ã ç‰¹åˆ¥ãªé¦¬ã§ã™
                    </div>
                `;
                
                actualHorseContainer.appendChild(rankingCard);
                
                // æœ‰æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                const premiumCard = document.createElement('div');
                premiumCard.style.marginTop = '20px';
                premiumCard.innerHTML = `
                    <button onclick="showPremiumModal()" style="
                        background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 25px;
                        font-size: 16px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: transform 0.3s;
                        box-shadow: 0 5px 15px rgba(232, 67, 147, 0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                        âœ¨ 2ä½ä»¥ä¸‹ã‚‚çŸ¥ã‚ŠãŸã„ï¼
                    </button>
                `;
                
                actualHorseContainer.appendChild(premiumCard);
            }
            
            // çµæœãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆæ±ºæ¸ˆå¾Œã«ä½¿ç”¨ï¼‰
            window.currentResult = result;
            
            document.getElementById('result').style.display = 'block';
            document.querySelector('.fortune-btn').disabled = false;
            
            // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('fortuneForm').reset();
            document.getElementById('result').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.querySelector('.fortune-btn').disabled = false;
            document.getElementById('actualHorseContainer').innerHTML = '';
            
            // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã®ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showPremiumModal() {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
            let modal = document.getElementById('premiumModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'premiumModal';
                modal.style.cssText = `
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.8);
                    animation: fadeIn 0.3s ease-out;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white;
                        margin: 5% auto;
                        padding: 30px;
                        border-radius: 20px;
                        width: 90%;
                        max-width: 500px;
                        text-align: center;
                        position: relative;
                        animation: slideIn 0.3s ease-out;
                        max-height: 90vh;
                        overflow-y: auto;
                    ">
                        <button onclick="closePremiumModal()" style="
                            position: absolute;
                            right: 15px;
                            top: 15px;
                            background: none;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                            color: #999;
                        ">Ã—</button>
                        
                        <h2 style="color: #e84393; margin-bottom: 20px;">ğŸŒŸ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ äºˆæƒ³</h2>
                        <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                            2ä½ã€œ5ä½ã®è©³ç´°äºˆæƒ³ã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™<br>
                            ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„ç«¶é¦¬äºˆæƒ³ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„
                        </p>
                        
                        <div style="
                            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
                            padding: 20px;
                            border-radius: 15px;
                            margin: 20px 0;
                        ">
                            <div style="font-size: 24px; font-weight: bold; color: #e17055;">Â¥100</div>
                            <div style="color: #636e72; font-size: 14px;">ä¸€å›é™ã‚Šã®ãŠæ”¯æ‰•ã„</div>
                        </div>
                        
                        <!-- Stripeæ±ºæ¸ˆãƒ•ã‚©ãƒ¼ãƒ  -->
                        <div class="payment-form">
                            <label for="card-element">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±</label>
                            <div id="card-element" class="stripe-element">
                                <!-- Stripe Elements will create form elements here -->
                            </div>
                            <div id="card-errors" class="stripe-error" role="alert"></div>
                            
                            <button type="button" onclick="handlePayment()" id="submit-payment" style="
                                background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
                                color: white;
                                border: none;
                                padding: 15px 40px;
                                border-radius: 50px;
                                font-size: 18px;
                                font-weight: bold;
                                cursor: pointer;
                                width: 100%;
                                margin: 20px 0 15px 0;
                                transition: transform 0.3s;
                            " onmouseover="this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.transform='translateY(0)'">
                                ğŸ’³ Â¥100ã‚’æ±ºæ¸ˆã™ã‚‹
                            </button>
                        </div>
                        
                        <p style="color: #999; font-size: 12px;">
                            ğŸ”’ SSLæš—å·åŒ–é€šä¿¡ã§å®‰å…¨ã«æ±ºæ¸ˆã•ã‚Œã¾ã™
                        </p>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            modal.style.display = 'block';
            
            // Stripe Elementsã‚’ãƒã‚¦ãƒ³ãƒˆ
            setTimeout(() => {
                if (cardElement && document.getElementById('card-element')) {
                    try {
                        cardElement.mount('#card-element');
                        
                        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                        cardElement.on('change', ({error}) => {
                            const displayError = document.getElementById('card-errors');
                            if (error) {
                                displayError.textContent = error.message;
                            } else {
                                displayError.textContent = '';
                            }
                        });
                    } catch (e) {
                        console.error('Card element mount error:', e);
                    }
                }
            }, 100);
        }

        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                // Stripe Elementsã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ
                if (cardElement) {
                    try {
                        cardElement.unmount();
                    } catch (e) {
                        console.error('Card element unmount error:', e);
                    }
                }
                modal.style.display = 'none';
            }
        }

        // Stripeæ±ºæ¸ˆå‡¦ç†ï¼ˆNetlify Functionså¯¾å¿œç‰ˆï¼‰
        async function handlePayment() {
            if (!stripe || !cardElement) {
                console.error('Stripe not initialized');
                return;
            }

            const submitButton = document.getElementById('submit-payment');
            const originalText = submitButton.innerHTML;
            
            submitButton.disabled = true;
            submitButton.innerHTML = 'ğŸ’³ å‡¦ç†ä¸­...';

            try {
                // Netlify Functionã‹ã‚‰clientSecretã‚’å–å¾—
                const response = await fetch('/.netlify/functions/create-payment-intent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: 100, // 100å††
                        currency: 'jpy'
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const { clientSecret } = await response.json();

                // æ±ºæ¸ˆã®ç¢ºèª
                const {error, paymentIntent} = await stripe.confirmCardPayment(clientSecret, {
                    payment_method: {
                        card: cardElement,
                        billing_details: {
                            name: 'ç«¶é¦¬å ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼',
                        },
                    }
                });

                if (error) {
                    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                    document.getElementById('card-errors').textContent = error.message;
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                    return;
                }

                // æ±ºæ¸ˆæˆåŠŸ
                if (paymentIntent.status === 'succeeded') {
                    submitButton.innerHTML = 'âœ… æ±ºæ¸ˆå®Œäº†ï¼';
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½è¡¨ç¤º
                    setTimeout(() => {
                        closePremiumModal();
                        showFullRankings();
                    }, 1000);
                }

            } catch (err) {
                console.error('Payment error:', err);
                document.getElementById('card-errors').textContent = 'æ±ºæ¸ˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
            }
        }

        // å…¨é †ä½ã‚’è¡¨ç¤º
        function showFullRankings() {
            const result = window.currentResult;
            if (!result || !result.rankings) return;
            
            const actualHorseContainer = document.getElementById('actualHorseContainer');
            
            // æ–°ã—ã„å®Œå…¨ç‰ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
            const fullRankingCard = document.createElement('div');
            fullRankingCard.className = 'actual-horse-card';
            fullRankingCard.style.background = 'linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%)';
            fullRankingCard.style.animation = 'slideIn 0.5s ease-out';
            
            fullRankingCard.innerHTML = `
                <div class="actual-horse-title">
                    ğŸ‰ å®Œå…¨äºˆæƒ³çµæœ - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆ
                </div>
                <div style="text-align: left; line-height: 1.8; font-size: 16px; color: #2d3436;">
                    <div style="margin: 8px 0;"><strong>ğŸ¥‡ 1ä½ï¼ˆæœ¬å‘½ï¼‰:</strong> <span style="color: #e17055; font-weight: bold;">${result.rankings.first}</span></div>
                    <div style="margin: 8px 0;"><strong>ğŸ¥ˆ 2ä½:</strong> <span style="color: #00b894; font-weight: bold;">${result.rankings.second}</span></div>
                    <div style="margin: 8px 0;"><strong>ğŸ¥‰ 3ä½:</strong> <span style="color: #fdcb6e; font-weight: bold;">${result.rankings.third}</span></div>
                    <div style="margin: 8px 0;"><strong>ğŸ“ 4ä½:</strong> <span style="color: #6c5ce7; font-weight: bold;">${result.rankings.fourth}</span></div>
                    <div style="margin: 8px 0;"><strong>ğŸ“ 5ä½:</strong> <span style="color: #a29bfe; font-weight: bold;">${result.rankings.fifth}</span></div>
                </div>
                <div class="actual-horse-message" style="margin-top: 15px;">
                    âœ¨ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ äºˆæƒ³å®Œäº†ï¼ã“ã®é †ä½ãŒã‚ãªãŸã®é‹å‘½ã®ç­”ãˆã§ã™
                </div>
            `;
            
            // æ—¢å­˜ã®ã‚«ãƒ¼ãƒ‰ã‚’ç½®ãæ›ãˆ
            actualHorseContainer.innerHTML = '';
            actualHorseContainer.appendChild(fullRankingCard);
            
            // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            fullRankingCard.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>